\documentclass[a4paper]{report}

\usepackage{template}

\usepackage{csquotes}

\usepackage[defernumbers=true, datamodel=archiving]{biblatex}
\input{archiving.lbx}

% Be more permissive about line breaks in URLs in the bibliography:
% Credit: https://tex.stackexchange.com/a/134281
\setcounter{biburllcpenalty}{7000}
\setcounter{biburlucpenalty}{8000}

\DeclareBibliographyCategory{formally-peer-reviewed}
\addtocategory{formally-peer-reviewed}{%
  emerald:tse:1987,%
  emerald:tocs:1988,%
  emerald:spe:1991,%
  erlang:hopl:2007,%
}

\DeclareBibliographyCategory{phd-theses}
\addtocategory{phd-theses}{%
  emerald:phd:norman-c-hutchinson,%
  emerald:phd:eric-jul,%
  emerald:phd:niels-christian-juul,%
}

\DeclareBibliographyCategory{manuals-and-techreports}
\addtocategory{manuals-and-techreports}{%
  erlang:2019:Erlang-OTP,%
  erlang:2019:Dialyzer,%
  erlang:2018:The-Erlang-Runtime-System,%
}

\DeclareBibliographyCategory{media}
\addtocategory{media}{%
  media:2008-03-13:facebook-chat,%
  media:2018-03-31:Erlang-20-years,%
  media:2014-02-21:Inside-Erlang,%
  media:2015-01-09:Klarna-Engineering-Insights,%
}

\addbibresource{references.bib}

\usepackage[numbib]{tocbibind}

\header{%
  course={Technical Report},%
  assignment={Towards a BEAMing Emerald},%
  authors={Oleks Shturmov \texttt{<\href{mailto:oleks@oleks.info}{oleks@oleks.info}>}},%
  affiliation={Department of Informatics\\University of Oslo},%
  shortAffiliation={IFI/UiO},%
  date={\today}
}

\newcommand\tm[0]{\textsuperscript{\scriptsize\texttrademark}}
\newcommand\longref[1]{\ref{#1} (page \pageref{#1})}

\usepackage{etoolbox}

\begin{document}

\maketitle

\tableofcontents

\input{01-Background/00-master}

\input{02-Analysis/00-master}

\chapter*{References}

\nocite{*}

\printbibliography[%
  title={Formally Peer-Reviewed},%
  category=formally-peer-reviewed,%
  heading=subbibliography%
]

\printbibliography[%
  title={PhD Theses},%
  category=phd-theses,%
  heading=subbibliography%
]

\printbibliography[%
  title={Manuals \& Techreports},%
  category=manuals-and-techreports,%
  heading=subbibliography%
]

\printbibliography[%
  title={Media},%
  category=media,%
  heading=subbibliography%
]

\pagebreak

\appendix

\input{appendix/00-master}

\end{document}
